import { Meta, Story, Preview, Props } from '@storybook/addon-docs/blocks';
import { State, Store } from "@sambego/storybook-state";
import { action } from '@storybook/addon-actions';
import { number, withKnobs } from '@storybook/addon-knobs';

import Comments from './comments/Comments';
import Entities from './newEntities/Entities';
import Playhead from './playhead/Playhead';
import Slider from './slider/Slider';
import Timeline from './Timeline';

import data from './timeline.data.json';

export const plainTimelineStore = new Store({
  currentTime: 0,
  data: {
    commentThreads: [],
    project: {
      projectclips: [],
      projectplaces: [],
      projecttags: [],
    },
    videoClips: [],
    videoPlaces: [],
    videoTags: [],
    user: { 
      first_name: "Mark",
      id: 2376,
      last_name: "Boas",
      profile_img_url: "https://lh4.googleusercontent.com/-KAQP-uwuJ-U/AAAAAAAAAAI/AAAAAAAAAA8/m1-ILT1IqWs/s100/photo.jpg",
    },
  },
  duration: 1000,
});
export const richTimelineStore = new Store({
  currentTime: 50,
  data: data,
  duration: 1000,
});
export const controlledTimelineStore = new Store({
  currentTime: 50,
  data: data,
  duration: 1000,
});
export const playheadStore = new Store({
  currentTime: 0,
  duration: 10000,
});

export const onPlainTimelineChange = (newTime) => {
  action('onTimeChange')(newTime);
  plainTimelineStore.set({ currentTime: newTime });
}
export const onPlainTimelineUpdate = (data) => {
  action('onPlainTimelineUpdate')(data);
  plainTimelineStore.set({ data: data });
}
export const onRichTimelineChange = (newTime) => {
  action('onTimeChange')(newTime);
  richTimelineStore.set({ currentTime: newTime });
}
export const onRichTimelineUpdate = (data) => {
  action('onRichTimelineUpdate')(data);
  richTimelineStore.set({ data: data });
}
export const onControlledTimelineUpdate = (data) => {
  action('onControlledTimelineUpdate')(data);
  controlledTimelineStore.set({ data: data });
}
export const onPlayheadChange = (newTime) => {
  action('onTimeChange')(newTime);
  playheadStore.set({ currentTime: newTime });
}
export const onCommentDelete = (threadId, commentId) => {
  action('onCommentDelete')(threadId, commentId);
}
export const onCommentEdit = (threadId, commentId, text, callback) => {
  action('onCommentDelete')(threadId, commentId, text, 'callback');
  if (callback) setTimeout(callback, 3000);
}
export const onCommentCreate = (threadId, text, callback) => {
  action('onCommentCreate')(threadId, text, 'callback');
  if (callback) setTimeout(callback, 3000);
}
export const onCommentThreadDelete = (threadId, callback) => {
  action('onCommentThreadDelete')(threadId, 'callback');
  if (callback) setTimeout(callback, 3000);
}
export const onCommentThreadCreate = (time, text, callback) => {
  action('onCommentThreadCreate')(time, text, 'callback');
  if (callback) setTimeout(callback, 3000);
}

<Meta title="Components/Timeline" component={Timeline} decorators={[withKnobs]} />

# Timeline

`@import { Timeline } from '@check/ui';`

## Plain

<Preview withToolbar={true}>
  <Story name="Plain">
    <State store={plainTimelineStore}>
      {state =>
        <Timeline
          currentTime={state.currentTime}
          data={state.data}
          duration={state.duration}
          onBeforeCommentThreadCreate={action('onBeforeCommentThreadCreate')}
          onCommentCreate={onCommentCreate}
          onCommentDelete={onCommentDelete}
          onCommentEdit={onCommentEdit}
          onCommentThreadCreate={onCommentThreadCreate}
          onCommentThreadDelete={onCommentThreadDelete}
          onTimeChange={onPlainTimelineChange}
        />
      }
     </State>
  </Story>
</Preview>

## Rich

<Preview withToolbar={true}>
  <Story name="Rich">
    <State store={richTimelineStore}>
      {state =>
        <Timeline
          currentTime={state.currentTime}
          data={state.data}
          duration={state.duration}
          onBeforeCommentThreadCreate={action('onBeforeCommentThreadCreate')}
          onCommentCreate={onCommentCreate}
          onCommentDelete={onCommentDelete}
          onCommentEdit={onCommentEdit}
          onCommentThreadCreate={onCommentThreadCreate}
          onCommentThreadDelete={onCommentThreadDelete}
          onTimeChange={onRichTimelineChange}
        />
      }
     </State>
  </Story>
</Preview>

## Controlled

<Preview withToolbar={true}>
  <Story name="Controlled">
    <State store={controlledTimelineStore}>
      {state =>
        <Timeline
          currentTime={number('Time', 100, {min: 0, max: 1000, step: 1, range: true})}
          data={state.data}
          duration={state.duration}
          onBeforeCommentThreadCreate={action('onBeforeCommentThreadCreate')}
          onCommentCreate={onCommentCreate}
          onCommentDelete={onCommentDelete}
          onCommentEdit={onCommentEdit}
          onCommentThreadCreate={onCommentThreadCreate}
          onCommentThreadDelete={onCommentThreadDelete}
          onTimeChange={action('onTimeChange')}
        />
      }
     </State>
  </Story>
</Preview>

## Props

<Props of={Timeline} />

# Partials

## Playhead

<Preview>
  <Story name="Partials » Playhead">
    <State store={playheadStore}>
      {state =>
        <Playhead
          currentTime={state.currentTime}
          duration={state.duration}
          onChange={onPlayheadChange}
        />
      }
     </State>
  </Story>
</Preview>

## Comments

<Preview>
  <Story name="Partials » Commments (Plain)">
    <Comments 
      duration={1000}
      user={{
        first_name: "Mark",
        id: 2376,
        last_name: "Boas",
        profile_img_url: "https://lh4.googleusercontent.com/-KAQP-uwuJ-U/AAAAAAAAAAI/AAAAAAAAAA8/m1-ILT1IqWs/s100/photo.jpg",
      }}
      onCommentCreate={action('onCommentCreate')}
      onCommentDelete={onCommentDelete}
      onCommentEdit={action('onCommentEdit')}
      onCommentThreadCreate={action('onCommentThreadCreate')}
      onCommentThreadDelete={action('onCommentThreadDelete')}
    />
  </Story>
</Preview>

<Preview>
  <Story name="Partials » Commments (Rich)">
    <Comments 
      duration={1000}
      user={{
        first_name: "Mark",
        id: 2376,
        last_name: "Boas",
        profile_img_url: "https://lh4.googleusercontent.com/-KAQP-uwuJ-U/AAAAAAAAAAI/AAAAAAAAAA8/m1-ILT1IqWs/s100/photo.jpg",
      }}
      onCommentCreate={action('onCommentCreate')}
      onCommentDelete={onCommentDelete}
      onCommentEdit={action('onCommentEdit')}
      onCommentThreadCreate={action('onCommentThreadCreate')}
      onCommentThreadDelete={action('onCommentThreadDelete')}
      threads={data.commentThreads}
    />
  </Story>
</Preview>

## Entities

<Preview>
  <Story name="Partials » Entities (Clips)">
    <Entities
      currentTime={0}
      duration={1000}
      entities={data.videoClips}
      onAfterChange={action('onAfterChange')}
      onBeforeChange={action('onBeforeChange')}
      onChange={action('onChange')}
      onInstanceDelete={action('onInstanceDelete')}
      onInstanceUpdate={action('onInstanceUpdate')}
      suggestions={[]}
      type="clips"
    />
  </Story>
</Preview>

<Preview>
  <Story name="Partials » Entities (Tags)">
    <Entities
      currentTime={0}
      duration={1000}
      entities={data.videoTags}
      onAfterChange={action('onAfterChange')}
      onBeforeChange={action('onBeforeChange')}
      onChange={action('onChange')}
      onInstanceClip={action('onInstanceClip')}
      onInstanceDelete={action('onInstanceDelete')}
      onInstanceUpdate={action('onInstanceUpdate')}
      suggestions={[]}
      type="tags"
    />
  </Story>
</Preview>

<Preview>
  <Story name="Partials » Entities (Places)">
    <Entities
      currentTime={0}
      duration={1000}
      entities={data.videoPlaces}
      onAfterChange={action('onAfterChange')}
      onBeforeChange={action('onBeforeChange')}
      onChange={action('onChange')}
      onEntityDelete={action('onEntityDelete')}
      onInstanceClip={action('onInstanceClip')}
      onInstanceDelete={action('onInstanceDelete')}
      onInstanceUpdate={action('onInstanceUpdate')}
      suggestions={[]}
      type="places"
    />
  </Story>
</Preview>

## Slider

<Preview>
  <Story name="Partials » Slider (Plain)">
    <Slider
      deleteInstance={action('deleteInstance')}
      duration={1000}
      instances={[]}
      onDrag={action('onDrag')}
      onDragEnd={action('onDragEnd')}
      onDragStart={action('onDragStart')}
      updateInstance={action('updateInstance')}
      threads={data.commentThreads}
    />
  </Story>
</Preview>

<Preview>
  <Story name="Partials » Slider (Clips)">
    <Slider
      deleteInstance={action('deleteInstance')}
      duration={1000}
      instances={data.videoClips[0].instances}
      onDrag={action('onDrag')}
      onDragEnd={action('onDragEnd')}
      onDragStart={action('onDragStart')}
      updateInstance={action('updateInstance')}
    />
  </Story>
</Preview>

<Preview>
  <Story name="Partials » Slider (Tags)">
    <Slider
      clipInstance={action('clipInstance')}
      deleteInstance={action('deleteInstance')}
      duration={1000}
      instances={data.videoTags[0].instances}
      onDrag={action('onDrag')}
      onDragEnd={action('onDragEnd')}
      onDragStart={action('onDragStart')}
      updateInstance={action('updateInstance')}
    />
  </Story>
</Preview>
